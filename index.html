<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat UI - Enhanced WhatsApp Style</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f6fa;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      .chat-container {
        width: 100%;
        max-width: 420px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 90vh;
        max-height: 700px;
      }

      /* HEADER */
      .chat-header {
        background: #1c0f87;
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 10px;
        cursor: pointer;
        user-select: none;
      }

      .chat-header .left,
      .chat-header .center,
      .chat-header .right {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .chat-header .center {
        flex-direction: column;
        text-align: center;
        flex: 1;
      }

      .chat-header .center h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 500;
      }

      .chat-header .center span {
        font-size: 12px;
        opacity: 0.8;
      }

      .icon-btn {
        background: transparent;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.2s;
      }

      .icon-btn:hover {
        opacity: 0.8;
      }

      .dropdown {
        position: relative;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background: white;
        color: black;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        z-index: 10;
        min-width: 180px;
        margin-top: 5px;
      }

      .dropdown-content a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 15px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        transition: background 0.2s;
      }

      .dropdown-content a:hover {
        background: #f0f0f0;
      }

      .dropdown-content .divider {
        height: 1px;
        background: #e0e0e0;
        margin: 5px 0;
      }

      .dropdown.active .dropdown-content {
        display: block;
      }

      /* SWITCH */
      .switch {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
      }

      .switch input {
        display: none;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        background-color: #ccc;
        border-radius: 20px;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        transition: 0.4s;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
        background: white;
        border-radius: 50%;
        transition: 0.4s;
      }

      input:checked + .slider {
        background-color: #4caf50;
      }

      input:checked + .slider:before {
        transform: translateX(20px);
      }

      .status-text {
        font-size: 13px;
        font-weight: 500;
      }

      /* MEDIA PANEL */
      .media-panel {
        display: none;
        background: #fafafa;
        border-bottom: 1px solid #ddd;
        max-height: 350px;
        overflow-y: auto;
      }

      .media-panel.active {
        display: block;
        animation: slideDown 0.3s ease forwards;
      }

      .media-actions {
        display: flex;
        justify-content: space-around;
        padding: 10px;
        border-bottom: 1px solid #ddd;
        background: white;
      }

      .media-actions button {
        background: #1c0f87;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 13px;
        transition: background 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .media-actions button:hover {
        background: #2a1ba0;
      }

      .media-tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        background: white;
      }

      .media-tabs button {
        flex: 1;
        padding: 10px;
        border: none;
        background: none;
        cursor: pointer;
        font-size: 14px;
        color: #555;
        transition: all 0.2s;
      }

      .media-tabs button.active {
        border-bottom: 2px solid #1c0f87;
        font-weight: bold;
        color: #1c0f87;
      }

      .media-content {
        padding: 10px;
      }

      .media-content h4 {
        margin: 10px 0 8px 0;
        font-size: 13px;
        color: #666;
      }

      .media-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 15px;
      }

      .media-grid img {
        width: 100%;
        aspect-ratio: 1;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .media-grid img:hover {
        transform: scale(1.05);
      }

      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }

      .tab-content ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .tab-content li {
        padding: 10px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
        cursor: pointer;
      }

      .tab-content li:hover {
        background: #f5f5f5;
      }

      .tab-content a {
        color: #1c0f87;
        text-decoration: none;
        word-break: break-all;
      }

      @keyframes slideDown {
        from {
          max-height: 0;
          opacity: 0;
        }
        to {
          max-height: 350px;
          opacity: 1;
        }
      }

      /* CHAT BODY */
      .chat-body {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background: white;
      }

      .message {
        margin: 8px 0;
        display: flex;
        flex-direction: column;
        animation: fadeIn 0.3s ease;
        position: relative;
        user-select: none;
        cursor: pointer;
      }

      .message:hover .text {
        opacity: 0.9;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .sent {
        align-items: flex-end;
      }

      .received {
        align-items: flex-start;
      }

      .sent .text {
        background: #1c0f87;
        color: white;
      }

      .received .text {
        background: rgb(209, 212, 211);
        color: #000;
      }

      .text {
        padding: 8px 12px;
        border-radius: 8px;
        max-width: 75%;
        position: relative;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        word-wrap: break-word;
      }

      .time {
        font-size: 11px;
        color: #667781;
        margin-top: 3px;
        margin-left: 5px;
        margin-right: 5px;
      }

      /* Voice Message Styles */
      .voice-message {
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 200px;
      }

      .voice-message svg {
        flex-shrink: 0;
      }

      .voice-translation {
        margin-top: 8px;
        padding: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        font-size: 13px;
        line-height: 1.4;
        animation: fadeIn 0.3s ease;
      }

      .sent .voice-translation {
        background: rgba(255, 255, 255, 0.15);
      }

      .received .voice-translation {
        background: rgba(0, 0, 0, 0.05);
      }

      .view-translation {
        display: inline-block;
        margin-top: 4px;
        font-size: 11px;
        opacity: 0.8;
        cursor: pointer;
        text-decoration: underline;
      }

      .view-translation:hover {
        opacity: 1;
      }

      /* Listen to Message (Text to Speech) */
      .listen-to-message {
        display: inline-block;
        margin-top: 4px;
        font-size: 11px;
        opacity: 0.8;
        cursor: pointer;
        text-decoration: underline;
      }

      .listen-to-message:hover {
        opacity: 1;
      }

      .listen-to-message.playing {
        color: #4caf50;
        font-weight: bold;
      }

      /* Message Translation */
      .translate-container {
        margin-top: 8px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }

      .translate-btn {
        display: inline-block;
        font-size: 11px;
        opacity: 0.8;
        cursor: pointer;
        text-decoration: underline;
        padding: 0;
        background: none;
        border: none;
        color: inherit;
      }

      .translate-btn:hover {
        opacity: 1;
      }

      .language-select {
        font-size: 11px;
        padding: 2px 6px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.1);
        color: inherit;
        cursor: pointer;
        display: none;
        margin-top: 4px;
      }

      .received .language-select {
        border-color: rgba(0, 0, 0, 0.2);
        background: rgba(0, 0, 0, 0.05);
        color: #000;
      }

      .language-select.visible {
        display: block;
      }

      .translated-text {
        margin-top: 8px;
        padding: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        font-size: 13px;
        line-height: 1.4;
        border-left: 3px solid rgba(255, 255, 255, 0.5);
        animation: fadeIn 0.3s ease;
      }

      .received .translated-text {
        background: rgba(0, 0, 0, 0.05);
        border-left-color: #1c0f87;
      }

      .translated-label {
        font-size: 10px;
        opacity: 0.7;
        margin-bottom: 4px;
        font-style: italic;
      }

      /* Message Context Menu */
      .message-context-menu {
        position: fixed;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        min-width: 150px;
        display: none;
      }

      .message-context-menu.active {
        display: block;
      }

      .message-context-menu button {
        width: 100%;
        padding: 12px 15px;
        border: none;
        background: none;
        text-align: left;
        cursor: pointer;
        font-size: 14px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: background 0.2s;
        pointer-events: auto;
      }

      .message-context-menu button:hover {
        background: #f0f0f0;
      }

      .message-context-menu button.delete {
        color: #d32f2f;
      }

      .message-context-menu button:first-child {
        border-radius: 8px 8px 0 0;
      }

      .message-context-menu button:last-child {
        border-radius: 0 0 8px 8px;
      }

      /* Deleted Message */
      .message.deleted .text {
        background: transparent !important;
        border: 1px solid #ddd;
        color: #999;
        font-style: italic;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
      }

      .deleted-icon {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
        opacity: 0.6;
      }

      /* INPUT */
      .chat-input {
        display: flex;
        align-items: center;
        padding: 8px 10px;
        border-top: 1px solid #ddd;
        background: #f0f0f0;
        gap: 8px;
      }

      .input-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: white;
        border-radius: 20px;
        overflow: hidden;
      }

      .formatting {
        display: flex;
        padding: 5px 10px;
        border-bottom: 1px solid #eee;
        gap: 5px;
      }

      .formatting button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 14px;
        color: #555;
      }

      .formatting button:hover {
        background: #f0f0f0;
      }

      .chat-input input {
        border: none;
        outline: none;
        padding: 10px 15px;
        font-size: 14px;
      }

      .voice-btn,
      .send-btn {
        background: #1c0f87;
        border: none;
        color: white;
        font-size: 20px;
        width: 42px;
        height: 42px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        flex-shrink: 0;
      }

      .voice-btn:hover,
      .send-btn:hover {
        background: #2a1ba0;
        transform: scale(1.05);
      }

      .voice-btn.recording {
        background: #ff4444;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .voice-btn.hidden {
        display: none;
      }

      /* Disabled Chat Input */
      .chat-input.disabled {
        padding: 15px 20px;
        justify-content: center;
        background: #f9f9f9;
        border-top: 2px solid #e0e0e0;
      }

      .chat-input.disabled .input-wrapper,
      .chat-input.disabled .voice-btn,
      .chat-input.disabled .send-btn {
        display: none;
      }

      .disabled-message {
        display: none;
        text-align: center;
        color: #666;
        font-size: 14px;
        line-height: 1.5;
        padding: 10px;
      }

      .chat-input.disabled .disabled-message {
        display: block;
      }

      /* Search Input in Media Panel */
      .search-container {
        padding: 10px;
        background: white;
        border-bottom: 1px solid #ddd;
      }

      .search-container input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        font-size: 14px;
      }

      .search-container input:focus {
        border-color: #1c0f87;
      }

      /* View Toggle Link */
      .view-toggle-link {
        padding: 12px 15px;
        background: white;
        border-bottom: 1px solid #ddd;
        text-align: center;
      }

      .view-toggle-link a {
        color: #1c0f87;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        transition: opacity 0.2s;
      }

      .view-toggle-link a:hover {
        opacity: 0.7;
      }

      /* Back Link */
      .back-link {
        padding: 12px 15px;
        background: white;
        border-bottom: 1px solid #ddd;
      }

      .back-link a {
        color: #1c0f87;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        transition: opacity 0.2s;
      }

      .back-link a:hover {
        opacity: 0.7;
      }

      /* Video Call Modal */
      .call-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        animation: fadeIn 0.3s ease;
      }

      .call-modal.active {
        display: flex;
        flex-direction: column;
      }

      .call-header {
        padding: 20px;
        text-align: center;
        color: white;
      }

      .call-header h2 {
        margin: 0 0 10px 0;
        font-size: 24px;
        font-weight: 500;
      }

      .call-status {
        color: #4caf50;
        font-size: 14px;
      }

      .call-timer {
        color: #aaa;
        font-size: 14px;
        margin-top: 5px;
      }

      .participants-grid {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .participant-tile {
        background: #1a1a1a;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        aspect-ratio: 4/3;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #333;
      }

      .participant-tile.speaking {
        border-color: #4caf50;
      }

      .participant-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: bold;
      }

      .participant-tile:nth-child(2) .participant-avatar {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .participant-tile:nth-child(3) .participant-avatar {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .participant-tile:nth-child(4) .participant-avatar {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      }

      .participant-info {
        position: absolute;
        bottom: 10px;
        left: 10px;
        color: white;
        font-size: 14px;
        font-weight: 500;
        background: rgba(0, 0, 0, 0.6);
        padding: 5px 10px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .mic-icon {
        width: 16px;
        height: 16px;
      }

      .mic-icon.muted {
        color: #f44336;
      }

      .call-controls {
        padding: 30px;
        display: flex;
        justify-content: center;
        gap: 20px;
      }

      .call-control-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        color: white;
      }

      .call-control-btn:hover {
        transform: scale(1.1);
      }

      .call-control-btn.mute {
        background: #555;
      }

      .call-control-btn.mute.active {
        background: #f44336;
      }

      .call-control-btn.video {
        background: #555;
      }

      .call-control-btn.video.active {
        background: #f44336;
      }

      .call-control-btn.end {
        background: #f44336;
        width: 70px;
        height: 70px;
      }

      .call-control-btn.end:hover {
        background: #d32f2f;
      }
    </style>
  </head>
  <body>
    <!-- Video Call Modal -->
    <div class="call-modal" id="callModal">
      <div class="call-header">
        <h2 id="callTitle">Video Call</h2>
        <div class="call-status">Connected</div>
        <div class="call-timer" id="callTimer">00:00</div>
      </div>

      <div class="participants-grid">
        <div class="participant-tile speaking">
          <div class="participant-avatar">You</div>
          <div class="participant-info">
            <svg
              class="mic-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
              ></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" y1="19" x2="12" y2="23"></line>
              <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
            You
          </div>
        </div>

        <div class="participant-tile">
          <div class="participant-avatar">JD</div>
          <div class="participant-info">
            <svg
              class="mic-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
              ></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" y1="19" x2="12" y2="23"></line>
              <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
            John Doe
          </div>
        </div>

        <div class="participant-tile">
          <div class="participant-avatar">AS</div>
          <div class="participant-info">
            <svg
              class="mic-icon muted"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="1" y1="1" x2="23" y2="23"></line>
              <path
                d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"
              ></path>
              <path
                d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"
              ></path>
              <line x1="12" y1="19" x2="12" y2="23"></line>
              <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
            Alice Smith
          </div>
        </div>

        <div class="participant-tile">
          <div class="participant-avatar">MB</div>
          <div class="participant-info">
            <svg
              class="mic-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
              ></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" y1="19" x2="12" y2="23"></line>
              <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
            Mike Brown
          </div>
        </div>
      </div>

      <div class="call-controls">
        <button class="call-control-btn mute" id="muteBtn" title="Mute/Unmute">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
            ></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="23"></line>
            <line x1="8" y1="23" x2="16" y2="23"></line>
          </svg>
        </button>

        <button class="call-control-btn end" id="endCallBtn" title="End Call">
          <svg
            width="28"
            height="28"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
            ></path>
            <line x1="23" y1="1" x2="1" y2="23"></line>
          </svg>
        </button>

        <button
          class="call-control-btn video"
          id="videoBtn"
          title="Turn Video On/Off"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polygon points="23 7 16 12 23 17 23 7"></polygon>
            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
          </svg>
        </button>
      </div>
    </div>

    <div class="chat-container">
      <!-- HEADER -->
      <div class="chat-header" id="chatHeader">
        <div class="left">
          <label class="switch">
            <input type="checkbox" id="statusToggle" checked />
            <span class="slider"></span>
          </label>
          <span class="status-text" id="statusText">Open</span>
        </div>
        <div class="center">
          <h3>25110090</h3>
          <span>Test</span>
        </div>
        <div class="right">
          <div class="dropdown" id="menuDropdown">
            <button class="icon-btn menu">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="12" cy="5" r="1"></circle>
                <circle cx="12" cy="19" r="1"></circle>
              </svg>
            </button>
            <div class="dropdown-content">
              <a href="#" data-action="audio">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                  ></path>
                </svg>
                Audio Call
              </a>
              <a href="#" data-action="video">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polygon points="23 7 16 12 23 17 23 7"></polygon>
                  <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                </svg>
                Video Call
              </a>
              <a href="#" data-action="search">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                Search
              </a>
              <div class="divider"></div>
              <a href="#" data-action="media">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <circle cx="8.5" cy="8.5" r="1.5"></circle>
                  <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                Media
              </a>
              <a href="#" data-action="links">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                  ></path>
                  <path
                    d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                  ></path>
                </svg>
                Links
              </a>
              <a href="#" data-action="docs">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                  ></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                Docs
              </a>
              <div class="divider"></div>
              <a href="#" data-action="adduser">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="8.5" cy="7" r="4"></circle>
                  <line x1="20" y1="8" x2="20" y2="14"></line>
                  <line x1="23" y1="11" x2="17" y2="11"></line>
                </svg>
                Add Participant
              </a>
              <a href="#" data-action="leavechat" style="color: #d32f2f">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16 17 21 12 16 7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Leave Chat
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- MEDIA PANEL (collapsible) -->
      <div class="media-panel" id="mediaPanel">
        <!-- Action Buttons View -->
        <div id="actionButtonsView">
          <div class="media-actions">
            <button id="audioBtn">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path
                  d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"
                ></path>
              </svg>
              Audio
            </button>
            <button id="videoBtn">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                ></path>
                <circle cx="12" cy="13" r="4"></circle>
              </svg>
              Video
            </button>
            <button id="searchBtn">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              Search
            </button>
            <button id="addParticipantBtn">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              Add
            </button>
          </div>

          <div
            class="search-container"
            id="searchContainer"
            style="display: none"
          >
            <input
              type="text"
              id="searchInput"
              placeholder="Search in conversation..."
            />
          </div>

          <div class="view-toggle-link">
            <a href="#" id="showMediaViewBtn">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="vertical-align: middle; margin-right: 5px"
              >
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
              Media, Links & Docs
            </a>
          </div>
        </div>

        <!-- Media/Links/Docs View -->
        <div id="mediaContentView" style="display: none">
          <div class="back-link">
            <a href="#" id="backToActionsBtn">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="vertical-align: middle; margin-right: 5px"
              >
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Back
            </a>
          </div>
          <div class="media-tabs">
            <button class="tab active" data-tab="media">Media</button>
            <button class="tab" data-tab="links">Links</button>
            <button class="tab" data-tab="docs">Docs</button>
          </div>
          <div class="media-content">
            <div class="tab-content active" id="media">
              <h4>Recent</h4>
              <div class="media-grid">
                <img src="https://picsum.photos/seed/a/100" alt="Media 1" />
                <img src="https://picsum.photos/seed/b/100" alt="Media 2" />
                <img src="https://picsum.photos/seed/c/100" alt="Media 3" />
              </div>
              <h4>Last Week</h4>
              <div class="media-grid">
                <img src="https://picsum.photos/seed/d/100" alt="Media 4" />
                <img src="https://picsum.photos/seed/e/100" alt="Media 5" />
                <img src="https://picsum.photos/seed/f/100" alt="Media 6" />
              </div>
            </div>
            <div class="tab-content" id="links">
              <ul>
                <li><a href="#">https://example.com/article</a></li>
                <li><a href="#">https://openai.com/chat</a></li>
                <li><a href="#">https://github.com/project</a></li>
              </ul>
            </div>
            <div class="tab-content" id="docs">
              <ul>
                <li>üìÑ report.pdf</li>
                <li>üìÑ invoice.docx</li>
                <li>üìä presentation.pptx</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Message Context Menu -->
      <div class="message-context-menu" id="messageContextMenu">
        <button data-action="copy">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path
              d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
            ></path>
          </svg>
          Copy
        </button>
        <button data-action="delete" class="delete">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="3 6 5 6 21 6"></polyline>
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            ></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          Delete
        </button>
      </div>

      <!-- CHAT BODY -->
      <div class="chat-body" id="chatBody">
        <div class="message sent">
          <div class="text">
            <div class="message-content">Test</div>
            <div class="listen-to-message" data-text="Test">
              Listen to message
            </div>
          </div>
          <span class="time">10:21 AM</span>
        </div>
        <div class="message sent">
          <div class="text">
            <div class="message-content">Testing</div>
            <div class="listen-to-message" data-text="Testing">
              Listen to message
            </div>
          </div>
          <span class="time">10:24 AM</span>
        </div>
        <div class="message received">
          <div class="text">
            <div class="message-content">„Åì„Çì„Å´„Å°„ÅØ„ÄÅÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü</div>
            <div class="listen-to-message" data-text="„Åì„Çì„Å´„Å°„ÅØ„ÄÅÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü">
              Listen to message
            </div>
            <div class="translate-container">
              <button
                class="translate-btn"
                data-original="„Åì„Çì„Å´„Å°„ÅØ„ÄÅÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü"
              >
                Translate
              </button>
              <select class="language-select">
                <option value="">Select language</option>
                <option value="en">English</option>
                <option value="fr">French</option>
                <option value="pt">Portuguese</option>
                <option value="ar">Arabic</option>
                <option value="es">Spanish</option>
              </select>
            </div>
          </div>
          <span class="time">5:38 PM</span>
        </div>
        <div class="message received">
          <div class="text">
            <div class="message-content">„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô</div>
            <div class="listen-to-message" data-text="„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô">
              Listen to message
            </div>
            <div class="translate-container">
              <button
                class="translate-btn"
                data-original="„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô"
              >
                Translate
              </button>
              <select class="language-select">
                <option value="">Select language</option>
                <option value="en">English</option>
                <option value="fr">French</option>
                <option value="pt">Portuguese</option>
                <option value="ar">Arabic</option>
                <option value="es">Spanish</option>
              </select>
            </div>
          </div>
          <span class="time">5:39 PM</span>
        </div>
        <div class="message received">
          <div class="text">
            <div class="message-content">‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠</div>
            <div class="listen-to-message" data-text="‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠">
              Listen to message
            </div>
            <div class="translate-container">
              <button
                class="translate-btn"
                data-original="‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠"
              >
                Translate
              </button>
              <select class="language-select">
                <option value="">Select language</option>
                <option value="en">English</option>
                <option value="fr">French</option>
                <option value="pt">Portuguese</option>
                <option value="ar">Arabic</option>
                <option value="es">Spanish</option>
              </select>
            </div>
          </div>
          <span class="time">5:40 PM</span>
        </div>
        <div class="message received">
          <div class="text">
            <div class="message-content">„Åä‰ºö„ÅÑ„Åß„Åç„Å¶Â¨â„Åó„ÅÑ„Åß„Åô</div>
            <div class="listen-to-message" data-text="„Åä‰ºö„ÅÑ„Åß„Åç„Å¶Â¨â„Åó„ÅÑ„Åß„Åô">
              Listen to message
            </div>
            <div class="translate-container">
              <button
                class="translate-btn"
                data-original="„Åä‰ºö„ÅÑ„Åß„Åç„Å¶Â¨â„Åó„ÅÑ„Åß„Åô"
              >
                Translate
              </button>
              <select class="language-select">
                <option value="">Select language</option>
                <option value="en">English</option>
                <option value="fr">French</option>
                <option value="pt">Portuguese</option>
                <option value="ar">Arabic</option>
                <option value="es">Spanish</option>
              </select>
            </div>
          </div>
          <span class="time">5:41 PM</span>
        </div>
      </div>

      <!-- INPUT BAR -->
      <div class="chat-input" id="chatInput">
        <button
          class="voice-btn"
          id="voiceBtn"
          title="Hold to record voice message"
        >
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
            ></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="23"></line>
            <line x1="8" y1="23" x2="16" y2="23"></line>
          </svg>
        </button>
        <div class="input-wrapper">
          <div class="formatting">
            <button title="Bold"><b>B</b></button>
            <button title="Italic"><i>I</i></button>
            <button title="Underline"><u>U</u></button>
            <button title="Bullet List">‚Ä¢</button>
            <button title="Attach">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"
                ></path>
              </svg>
            </button>
          </div>
          <input
            type="text"
            id="messageInput"
            placeholder="Type message here or drag attachments..."
          />
        </div>
        <button class="send-btn" id="sendBtn" title="Send message">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
        <div class="disabled-message">
          You can't send messages to this thread because you're no longer a
          member
        </div>
      </div>
    </div>

    <script>
      // Toggle media panel visibility when clicking header
      const header = document.getElementById("chatHeader");
      const mediaPanel = document.getElementById("mediaPanel");

      header.addEventListener("click", (e) => {
        // Don't toggle if clicking on buttons or dropdown
        if (
          e.target.closest(".icon-btn") ||
          e.target.closest(".dropdown") ||
          e.target.closest(".switch")
        ) {
          return;
        }
        mediaPanel.classList.toggle("active");
      });

      // Tab switching
      const tabs = document.querySelectorAll(".tab");
      const contents = document.querySelectorAll(".tab-content");

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          tabs.forEach((t) => t.classList.remove("active"));
          contents.forEach((c) => c.classList.remove("active"));
          tab.classList.add("active");
          document.getElementById(tab.dataset.tab).classList.add("active");
        });
      });

      // Dropdown menu toggle
      const menuDropdown = document.getElementById("menuDropdown");
      const menuBtn = menuDropdown.querySelector(".menu");

      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        menuDropdown.classList.toggle("active");
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (!menuDropdown.contains(e.target)) {
          menuDropdown.classList.remove("active");
        }
      });

      // Status toggle
      const statusToggle = document.getElementById("statusToggle");
      const statusText = document.getElementById("statusText");

      statusToggle.addEventListener("change", () => {
        statusText.textContent = statusToggle.checked ? "Open" : "Closed";
      });

      // Media action buttons
      const callModal = document.getElementById("callModal");
      const callTimer = document.getElementById("callTimer");
      const callTitle = document.getElementById("callTitle");
      let callStartTime;
      let callTimerInterval;

      function startCall(type) {
        callTitle.textContent = type === "audio" ? "Audio Call" : "Video Call";
        callModal.classList.add("active");
        callStartTime = Date.now();

        // Update timer every second
        callTimerInterval = setInterval(() => {
          const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
          const minutes = Math.floor(elapsed / 60);
          const seconds = elapsed % 60;
          callTimer.textContent = `${String(minutes).padStart(2, "0")}:${String(
            seconds
          ).padStart(2, "0")}`;
        }, 1000);

        // Simulate random speaking animation
        setInterval(() => {
          const tiles = document.querySelectorAll(".participant-tile");
          tiles.forEach((tile) => tile.classList.remove("speaking"));
          const randomTile = tiles[Math.floor(Math.random() * tiles.length)];
          randomTile.classList.add("speaking");
        }, 2000);
      }

      function endCall() {
        callModal.classList.remove("active");
        clearInterval(callTimerInterval);
        callTimer.textContent = "00:00";
      }

      document.getElementById("audioBtn").addEventListener("click", () => {
        startCall("audio");
      });

      document.getElementById("videoBtn").addEventListener("click", () => {
        startCall("video");
      });

      // Call control buttons
      document.getElementById("endCallBtn").addEventListener("click", () => {
        endCall();
      });

      const muteBtn = document.getElementById("muteBtn");
      muteBtn.addEventListener("click", () => {
        muteBtn.classList.toggle("active");
      });

      const videoToggleBtn = callModal.querySelector("#videoBtn");
      videoToggleBtn.addEventListener("click", () => {
        videoToggleBtn.classList.toggle("active");
      });

      document
        .getElementById("addParticipantBtn")
        .addEventListener("click", () => {
          alert("Add participant feature!");
        });

      const searchContainer = document.getElementById("searchContainer");
      const searchInput = document.getElementById("searchInput");

      document.getElementById("searchBtn").addEventListener("click", () => {
        if (searchContainer.style.display === "none") {
          searchContainer.style.display = "block";
          searchInput.focus();
        } else {
          searchContainer.style.display = "none";
          searchInput.value = "";
        }
      });

      // View switching
      const actionButtonsView = document.getElementById("actionButtonsView");
      const mediaContentView = document.getElementById("mediaContentView");
      const showMediaViewBtn = document.getElementById("showMediaViewBtn");
      const backToActionsBtn = document.getElementById("backToActionsBtn");

      showMediaViewBtn.addEventListener("click", (e) => {
        e.preventDefault();
        actionButtonsView.style.display = "none";
        mediaContentView.style.display = "block";
      });

      backToActionsBtn.addEventListener("click", (e) => {
        e.preventDefault();
        mediaContentView.style.display = "none";
        actionButtonsView.style.display = "block";
      });

      // Dropdown actions
      document.querySelectorAll(".dropdown-content a").forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const action = e.currentTarget.dataset.action;

          // Open media panel if not already open
          if (!mediaPanel.classList.contains("active")) {
            mediaPanel.classList.add("active");
          }

          // Always show action buttons view first
          actionButtonsView.style.display = "block";
          mediaContentView.style.display = "none";

          switch (action) {
            case "audio":
              startCall("audio");
              break;
            case "video":
              startCall("video");
              break;
            case "search":
              searchContainer.style.display = "block";
              searchInput.focus();
              break;
            case "media":
              // Switch to Media tab in media content view
              actionButtonsView.style.display = "none";
              mediaContentView.style.display = "block";
              tabs.forEach((t) => t.classList.remove("active"));
              contents.forEach((c) => c.classList.remove("active"));
              document
                .querySelector('[data-tab="media"]')
                .classList.add("active");
              document.getElementById("media").classList.add("active");
              break;
            case "links":
              // Switch to Links tab in media content view
              actionButtonsView.style.display = "none";
              mediaContentView.style.display = "block";
              tabs.forEach((t) => t.classList.remove("active"));
              contents.forEach((c) => c.classList.remove("active"));
              document
                .querySelector('[data-tab="links"]')
                .classList.add("active");
              document.getElementById("links").classList.add("active");
              break;
            case "docs":
              // Switch to Docs tab in media content view
              actionButtonsView.style.display = "none";
              mediaContentView.style.display = "block";
              tabs.forEach((t) => t.classList.remove("active"));
              contents.forEach((c) => c.classList.remove("active"));
              document
                .querySelector('[data-tab="docs"]')
                .classList.add("active");
              document.getElementById("docs").classList.add("active");
              break;
            case "adduser":
              alert("Add participant feature!");
              break;
            case "leavechat":
              if (confirm("Are you sure you want to leave this chat?")) {
                // Disable the chat input
                const chatInput = document.getElementById("chatInput");
                chatInput.classList.add("disabled");

                // Optionally close the media panel
                mediaPanel.classList.remove("active");

                console.log("User left the chat");
              }
              break;
          }

          menuDropdown.classList.remove("active");
        });
      });

      // Voice recording
      const voiceBtn = document.getElementById("voiceBtn");
      const messageInput = document.getElementById("messageInput");
      const sendBtn = document.getElementById("sendBtn");
      let isRecording = false;

      voiceBtn.addEventListener("mousedown", () => {
        isRecording = true;
        voiceBtn.classList.add("recording");
        console.log("Recording started...");
      });

      voiceBtn.addEventListener("mouseup", () => {
        if (isRecording) {
          isRecording = false;
          voiceBtn.classList.remove("recording");
          addVoiceMessage();
        }
      });

      voiceBtn.addEventListener("mouseleave", () => {
        if (isRecording) {
          isRecording = false;
          voiceBtn.classList.remove("recording");
          console.log("Recording cancelled");
        }
      });

      // Show/hide voice button based on input
      messageInput.addEventListener("input", () => {
        if (messageInput.value.trim()) {
          voiceBtn.classList.add("hidden");
        } else {
          voiceBtn.classList.remove("hidden");
        }
      });

      // Send message
      sendBtn.addEventListener("click", sendMessage);
      messageInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          sendMessage();
        }
      });

      function sendMessage() {
        const text = messageInput.value.trim();
        if (!text) return;

        const chatBody = document.getElementById("chatBody");
        const time = new Date().toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
        });
        const messageId = "msg-" + Date.now();

        const messageDiv = document.createElement("div");
        messageDiv.className = "message sent";
        messageDiv.innerHTML = `
        <div class="text">
          <div class="message-content">${text}</div>
          <div class="listen-to-message" data-id="${messageId}" data-text="${text.replace(
          /"/g,
          "&quot;"
        )}">
            Listen to message
          </div>
        </div>
        <span class="time">${time}</span>
      `;

        chatBody.appendChild(messageDiv);
        chatBody.scrollTop = chatBody.scrollHeight;
        messageInput.value = "";
        voiceBtn.classList.remove("hidden");

        // Add text-to-speech listener
        const listenBtn = messageDiv.querySelector(".listen-to-message");
        addTextToSpeechListener(listenBtn);

        // Add context menu listeners to the newly created message
        addMessageListeners(messageDiv);
      }

      function addVoiceMessage() {
        const chatBody = document.getElementById("chatBody");
        const time = new Date().toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
        });

        // Sample translations - in real app, this would come from speech-to-text API
        const sampleTranslations = [
          "Hello, how are you doing today?",
          "I'll be there in 5 minutes",
          "Can we schedule a meeting for tomorrow?",
          "Thanks for the update, I really appreciate it",
          "Let me know when you're available to talk",
        ];

        const randomTranslation =
          sampleTranslations[
            Math.floor(Math.random() * sampleTranslations.length)
          ];
        const messageId = "voice-" + Date.now();

        const messageDiv = document.createElement("div");
        messageDiv.className = "message sent";
        messageDiv.innerHTML = `
        <div class="text">
          <div class="voice-message">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" y1="19" x2="12" y2="23"></line>
              <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
            <span>Voice message (0:0${Math.floor(Math.random() * 6) + 3})</span>
          </div>
          <div class="view-translation" data-id="${messageId}" data-translation="${randomTranslation}">
            Tap to view translation
          </div>
          <div id="${messageId}" class="voice-translation" style="display: none;">
            ${randomTranslation}
          </div>
        </div>
        <span class="time">${time}</span>
      `;

        chatBody.appendChild(messageDiv);
        chatBody.scrollTop = chatBody.scrollHeight;

        // Add click handler for translation toggle
        const translationBtn = messageDiv.querySelector(".view-translation");
        const translationDiv = messageDiv.querySelector(".voice-translation");

        translationBtn.addEventListener("click", function () {
          if (translationDiv.style.display === "none") {
            translationDiv.style.display = "block";
            this.textContent = "Hide translation";
          } else {
            translationDiv.style.display = "none";
            this.textContent = "Tap to view translation";
          }
        });

        // Add listeners to the newly created message
        addMessageListeners(messageDiv);
      }

      // Search functionality
      searchInput.addEventListener("input", function () {
        const searchTerm = this.value.toLowerCase();
        const messages = document.querySelectorAll(".message");

        messages.forEach((msg) => {
          const text = msg.querySelector(".text").textContent.toLowerCase();
          if (searchTerm && !text.includes(searchTerm)) {
            msg.style.opacity = "0.3";
          } else {
            msg.style.opacity = "1";
          }
        });
      });

      // Text-to-Speech functionality
      let currentSpeech = null;

      function addTextToSpeechListener(listenElement) {
        if (!listenElement) return;

        listenElement.addEventListener("click", function () {
          const text = this.dataset.text;

          // If already playing this message, stop it
          if (this.classList.contains("playing")) {
            if (currentSpeech) {
              window.speechSynthesis.cancel();
              currentSpeech = null;
            }
            this.classList.remove("playing");
            this.textContent = "Listen to message";
            return;
          }

          // Stop any currently playing speech
          if (currentSpeech) {
            window.speechSynthesis.cancel();
            document
              .querySelectorAll(".listen-to-message.playing")
              .forEach((el) => {
                el.classList.remove("playing");
                el.textContent = "Listen to message";
              });
          }

          // Check if browser supports speech synthesis
          if ("speechSynthesis" in window) {
            currentSpeech = new SpeechSynthesisUtterance(text);

            // Set voice properties
            currentSpeech.rate = 1.0; // Speed
            currentSpeech.pitch = 1.0; // Pitch
            currentSpeech.volume = 1.0; // Volume

            // Mark as playing
            this.classList.add("playing");
            this.textContent = "Stop listening";

            // When speech ends
            currentSpeech.onend = () => {
              this.classList.remove("playing");
              this.textContent = "Listen to message";
              currentSpeech = null;
            };

            // Handle errors
            currentSpeech.onerror = (event) => {
              console.error("Speech synthesis error:", event);
              this.classList.remove("playing");
              this.textContent = "Listen to message";
              currentSpeech = null;
            };

            // Speak the text
            window.speechSynthesis.speak(currentSpeech);
          } else {
            alert("Text-to-speech is not supported in your browser");
          }
        });
      }

      // Add text-to-speech to existing messages on page load
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM Content Loaded - Adding listeners");

        document.querySelectorAll(".listen-to-message").forEach((el) => {
          addTextToSpeechListener(el);
        });

        // Add translation listeners to existing messages
        document.querySelectorAll(".translate-btn").forEach((btn) => {
          console.log("Found translate button:", btn);
          addTranslationListener(btn);
        });
      });

      // Translation functionality - SIMPLIFIED
      function addTranslationListener(translateBtn) {
        if (!translateBtn) {
          console.log("No translate button provided");
          return;
        }

        const textElement = translateBtn.closest(".text");
        const languageSelect = textElement.querySelector(".language-select");

        console.log("Adding translation listener to button", translateBtn);
        console.log("Found language select:", languageSelect);

        // Remove any existing listeners first
        const newBtn = translateBtn.cloneNode(true);
        translateBtn.parentNode.replaceChild(newBtn, translateBtn);
        translateBtn = newBtn;

        // Toggle language selector when clicking translate button
        translateBtn.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();
          console.log("Translate button clicked!");
          console.log(
            "Current visibility:",
            languageSelect.classList.contains("visible")
          );

          if (languageSelect.classList.contains("visible")) {
            console.log("Hiding dropdown");
            languageSelect.classList.remove("visible");
            const existingTranslation =
              textElement.querySelector(".translated-text");
            if (existingTranslation) {
              existingTranslation.remove();
            }
            this.textContent = "Translate";
          } else {
            console.log("Showing dropdown");
            languageSelect.classList.add("visible");
            this.textContent = "Select language";
          }
        });

        // Handle language selection
        languageSelect.addEventListener("change", function (e) {
          e.preventDefault();
          e.stopPropagation();
          const targetLang = this.value;
          console.log("Language selected:", targetLang);

          if (!targetLang) return;

          const originalText = translateBtn.getAttribute("data-original");
          console.log("Original text:", originalText);

          // Remove any existing translation
          const existingTranslation =
            textElement.querySelector(".translated-text");
          if (existingTranslation) {
            existingTranslation.remove();
          }

          // Show loading
          translateBtn.textContent = "Translating...";

          // Get translation
          setTimeout(() => {
            const translatedText = getTranslation(originalText, targetLang);
            console.log("Translated text:", translatedText);

            // Create and show translation
            const translationDiv = document.createElement("div");
            translationDiv.className = "translated-text";
            translationDiv.innerHTML = `
            <div class="translated-label">Translated to ${getLanguageName(
              targetLang
            )}:</div>
            ${translatedText}
          `;

            const translateContainer = textElement.querySelector(
              ".translate-container"
            );
            translateContainer.after(translationDiv);

            translateBtn.textContent = "Hide translation";
            languageSelect.classList.remove("visible");
            languageSelect.value = "";
          }, 500);
        });
      }

      // Simple translation lookup
      function getTranslation(text, targetLang) {
        const translations = {
          "„Åì„Çì„Å´„Å°„ÅØ„ÄÅÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü": {
            en: "Hello, how are you?",
            es: "Hola, ¬øc√≥mo est√°s?",
            fr: "Bonjour, comment allez-vous?",
            pt: "Ol√°, como voc√™ est√°?",
            ar: "ŸÖÿ±ÿ≠ÿ®ÿß ŸÉŸäŸÅ ÿ≠ÿßŸÑŸÉÿü",
          },
          „ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô: {
            en: "Thank you very much",
            es: "Muchas gracias",
            fr: "Merci beaucoup",
            pt: "Muito obrigado",
            ar: "ÿ¥ŸÉÿ±ÿß ÿ¨ÿ≤ŸäŸÑÿß",
          },
          ‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠: {
            en: "It's nice weather today",
            es: "Hace buen tiempo hoy",
            fr: "Il fait beau aujourd'hui",
            pt: "Est√° um tempo bonito hoje",
            ar: "ÿßŸÑÿ∑ŸÇÿ≥ ÿ¨ŸÖŸäŸÑ ÿßŸÑŸäŸàŸÖ",
          },
          „Åä‰ºö„ÅÑ„Åß„Åç„Å¶Â¨â„Åó„ÅÑ„Åß„Åô: {
            en: "I'm happy to meet you",
            es: "Estoy feliz de conocerte",
            fr: "Je suis heureux de vous rencontrer",
            pt: "Estou feliz em conhec√™-lo",
            ar: "Ÿäÿ≥ÿπÿØŸÜŸä ŸÑŸÇÿßÿ§ŸÉ",
          },
        };

        if (translations[text] && translations[text][targetLang]) {
          return translations[text][targetLang];
        }

        return `[Translation to ${targetLang}] ${text}`;
      }

      // Get language name from code
      function getLanguageName(code) {
        const languages = {
          en: "English",
          es: "Spanish",
          fr: "French",
          pt: "Portuguese",
          ar: "Arabic",
        };
        return languages[code] || code;
      }

      // Message Context Menu (Long Press / Right Click)
      const messageContextMenu = document.getElementById("messageContextMenu");
      let longPressTimer;
      let currentMessage = null;

      // Function to show context menu
      function showContextMenu(e, messageElement) {
        e.preventDefault();
        e.stopPropagation();
        currentMessage = messageElement;

        // Position the menu
        let x, y;
        if (e.touches && e.touches.length > 0) {
          x = e.touches[0].clientX;
          y = e.touches[0].clientY;
        } else {
          x = e.clientX;
          y = e.clientY;
        }

        // Make sure menu doesn't go off screen
        const menuWidth = 150;
        const menuHeight = 200;
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;

        if (x + menuWidth > windowWidth) {
          x = windowWidth - menuWidth - 10;
        }
        if (y + menuHeight > windowHeight) {
          y = windowHeight - menuHeight - 10;
        }

        messageContextMenu.style.left = x + "px";
        messageContextMenu.style.top = y + "px";
        messageContextMenu.classList.add("active");

        console.log("Context menu shown at:", x, y);
      }

      // Function to hide context menu
      function hideContextMenu() {
        messageContextMenu.classList.remove("active");
        currentMessage = null;
      }

      // Add event listeners to messages
      function addMessageListeners(messageElement) {
        // Long press for mobile
        messageElement.addEventListener(
          "touchstart",
          (e) => {
            longPressTimer = setTimeout(() => {
              showContextMenu(e, messageElement);
            }, 500); // 500ms long press
          },
          { passive: false }
        );

        messageElement.addEventListener("touchend", () => {
          clearTimeout(longPressTimer);
        });

        messageElement.addEventListener("touchmove", () => {
          clearTimeout(longPressTimer);
        });

        // Right click for desktop
        messageElement.addEventListener("contextmenu", (e) => {
          showContextMenu(e, messageElement);
        });

        // Also add regular click for testing (you can remove this later)
        messageElement.addEventListener("dblclick", (e) => {
          showContextMenu(e, messageElement);
        });
      }

      // Add listeners to all existing messages
      document.querySelectorAll(".message").forEach((msg) => {
        addMessageListeners(msg);
        // Also add text-to-speech listener if the message has one
        const listenBtn = msg.querySelector(".listen-to-message");
        if (listenBtn) {
          addTextToSpeechListener(listenBtn);
        }
        // Add translation listener for received messages
        if (msg.classList.contains("received")) {
          const translateBtn = msg.querySelector(".translate-btn");
          if (translateBtn) {
            addTranslationListener(translateBtn);
          }
        }
        console.log("Listener added to message:", msg);
      });

      // Helper function to create a received message with translation
      function createReceivedMessage(text, time) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "message received";
        messageDiv.innerHTML = `
        <div class="text">
          <div class="message-content">${text}</div>
          <div class="listen-to-message" data-text="${text.replace(
            /"/g,
            "&quot;"
          )}">
            Listen to message
          </div>
          <div class="translate-container">
            <button class="translate-btn" data-original="${text.replace(
              /"/g,
              "&quot;"
            )}">
              Translate
            </button>
            <select class="language-select">
              <option value="">Select language</option>
              <option value="en">English</option>
              <option value="fr">French</option>
              <option value="pt">Portuguese</option>
              <option value="ar">Arabic</option>
              <option value="es">Spanish</option>
            </select>
          </div>
        </div>
        <span class="time">${time}</span>
      `;

        const chatBody = document.getElementById("chatBody");
        chatBody.appendChild(messageDiv);
        chatBody.scrollTop = chatBody.scrollHeight;

        // Add all listeners
        addMessageListeners(messageDiv);
        const listenBtn = messageDiv.querySelector(".listen-to-message");
        if (listenBtn) {
          addTextToSpeechListener(listenBtn);
        }
        const translateBtn = messageDiv.querySelector(".translate-btn");
        if (translateBtn) {
          addTranslationListener(translateBtn);
        }
      }

      // Demo: Add button to simulate receiving message in different language (for testing)
      // You can remove this in production
      window.simulateReceivedMessage = function () {
        const messages = [
          "„Åì„Çì„Å´„Å°„ÅØ„ÄÅÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü", // Japanese: Hello, how are you?
          "Bonjour, comment allez-vous?", // French
          "Hola, ¬øc√≥mo est√°s?", // Spanish
          "‰Ω†Â•ΩÔºå‰Ω†Â•ΩÂêóÔºü", // Chinese
          "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?", // Russian
          "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£", // Thai
        ];
        const randomMessage =
          messages[Math.floor(Math.random() * messages.length)];
        const time = new Date().toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
        });
        createReceivedMessage(randomMessage, time);
      };

      // Hide menu when clicking outside
      document.addEventListener("click", (e) => {
        // Don't hide if clicking inside the context menu
        if (messageContextMenu.contains(e.target)) {
          console.log("Clicked inside context menu");
          return;
        }
        // Don't hide if clicking on a message (to allow opening menu)
        if (e.target.closest(".message")) {
          console.log("Clicked on message");
          return;
        }
        console.log("Clicked outside, hiding menu");
        hideContextMenu();
      });

      document.addEventListener("touchstart", (e) => {
        if (messageContextMenu.contains(e.target)) {
          return;
        }
        if (e.target.closest(".message")) {
          return;
        }
        hideContextMenu();
      });

      // Context menu actions
      document
        .querySelectorAll(".message-context-menu button")
        .forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            const action = btn.dataset.action;

            console.log(
              "Action clicked:",
              action,
              "Current message:",
              currentMessage
            );

            if (!currentMessage) {
              console.log("No current message selected");
              hideContextMenu();
              return;
            }

            // Store reference before hiding menu
            const messageToProcess = currentMessage;

            switch (action) {
              case "copy":
                console.log("Copy action");
                const textElement = messageToProcess.querySelector(".text");
                if (textElement) {
                  // Get text from message-content div if it exists, otherwise get from text element
                  const contentDiv =
                    textElement.querySelector(".message-content");
                  let textContent;

                  if (contentDiv) {
                    textContent =
                      contentDiv.textContent || contentDiv.innerText;
                  } else {
                    textContent =
                      textElement.textContent || textElement.innerText;
                    // Remove "Listen to message" and "Tap to view translation" texts if present
                    textContent = textContent
                      .replace(/Listen to message/g, "")
                      .replace(/Stop listening/g, "")
                      .replace(/Tap to view translation/g, "")
                      .replace(/Hide translation/g, "")
                      .replace(/Translate/g, "")
                      .replace(/Select language/g, "")
                      .trim();
                  }

                  console.log("Text to copy:", textContent);

                  // Try modern clipboard API first
                  if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard
                      .writeText(textContent)
                      .then(() => {
                        console.log("Text copied successfully");
                      })
                      .catch((err) => {
                        console.error("Clipboard error:", err);
                      });
                  }
                }
                hideContextMenu();
                break;

              case "delete":
                console.log("Delete action");
                messageToProcess.classList.add("deleted");
                const textEl = messageToProcess.querySelector(".text");
                if (textEl) {
                  // Clear all content and replace with deleted message with icon
                  textEl.innerHTML = `
                <svg class="deleted-icon" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8.00016 14.6654C4.31826 14.6654 1.3335 11.6806 1.3335 7.9987C1.3335 4.3168 4.31826 1.33203 8.00016 1.33203C11.6821 1.33203 14.6668 4.3168 14.6668 7.9987C14.6668 11.6806 11.6821 14.6654 8.00016 14.6654ZM7.3335 9.9987V11.332H8.66683V9.9987H7.3335ZM7.3335 4.66536V8.66536H8.66683V4.66536H7.3335Z" fill="currentColor"/>
                </svg>
                <span>This message was deleted</span>
              `;
                  console.log("Message deleted successfully");
                }
                hideContextMenu();
                break;

              default:
                console.log("Unknown action:", action);
                hideContextMenu();
            }
          });
        });
    </script>
  </body>
</html>
